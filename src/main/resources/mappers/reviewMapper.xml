<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 다른 mapper와 중복되지 않도록 네임스페이스 기재 -->
<mapper namespace="review">

	<!-- 리뷰 DB -->
	<select id="reviewList" parameterType="hashMap" resultType="com.example.boardinfo.model.review.dto.ReviewDTO">
		SELECT
			R.REG_NUM AS REGNUM
			 , M.NICKNAME
			 , R.CATEGORY
			 , R.VIEWS
			 , G.GAMETITLE
			 , R.GATHERING_ID
			 , R.TITLE
			 , R.FUN_SCORE
			 , R.REVIEW_SCORE
			 , R.GAME_SCORE
			 , R.REVIEW_DETAIL AS REVIEWDETAIL
			 , R.GOOD
			 , R.DEL
			 , R.CREATE_USER
			 , TO_CHAR(R.CREATE_DATE, 'YYYY-MM-DD') AS CREATEDATE
			 , R.UPDATE_USER
			 , R.UPDATE_DATE
		FROM REVIEW R
		   , MEMBER M
		   , GAME G
		WHERE R.CREATE_USER = M.USERID
		  AND R.GNUM = G.GNUM
		  AND G.GAMETITLE = G.GAMETITLE
		  AND R.DEL = 'N'
		  /*검색*/
		<if test="searchTitle != '' and searchTitle != null">
			AND (R.TITLE LIKE '%'||#{searchTitle}||'%'
			OR R.REVIEW_DETAIL LIKE '%'||#{searchTitle}||'%')
		</if>
		  /*디테일 진입*/
		<if test="reviewDetailKey != '' and reviewDetailKey != null">
			AND R.REG_NUM = #{reviewDetailKey}
		</if>

	</select>

	<!-- 리뷰 입력 -->
	<insert id="reviewInsertPage" parameterType="hashMap">
		INSERT INTO REVIEW (
		                    REG_NUM
		                    , CATEGORY, GNUM
		                    , GATHERING_ID, TITLE
							, REVIEW_SCORE, REVIEW_DETAIL
							, CREATE_USER
							)
		VALUES(
		       to_char(sysdate, 'yymmdd') || LPAD(NVL((select MAX(SUBSTR(REG_NUM, 7)) + 1 from review where REG_NUM LIKE to_char(sysdate, 'yymmdd') || '%'), '1'),5, 0)
		   	  ,#{category}
			  ,#{gnum}
			  ,#{gatheringId}
			  ,#{title}
			  ,#{reviewScore}
			  ,#{reviewDetail}
			  ,#{createUser}
			  )
	</insert>

	<!-- 리뷰 수정 -->
	<update id="reviewedit" parameterType="hashMap">
		UPDATE REVIEW
		SET CATEGORY = #{category}
		    , TITLE = #{title}
		    , REVIEW_DETAIL = #{reviewDetail}
		WHERE 1 = 1
			AND REG_NUM = #{regNum}
	</update>

	<!-- 리뷰 삭제 -->
	<update id="revieweDel" parameterType="hashMap">
		UPDATE REVIEW
		SET DEL = 'Y'
		WHERE 1 = 1
		  AND REG_NUM = #{reviewDetailKey}
	</update>





	<insert id="reviewBlob" parameterType="hashMap">
		INSERT INTO REVIEW_IN_TEST (TEST1, BLOB)
		    VALUES(#{test1}
		    		,#{blob})
	</insert>


</mapper>




















